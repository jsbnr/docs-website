---
title: 'Heroku: New Relic add-onのインストール'
tags:
  - Accounts
  - Accounts and billing
  - Partner installation
metaDescription: 'Heroku users: How to install and manage the New Relic agent as an add-on account.'
translationType: machine
---

[Heroku](https://devcenter.heroku.com/articles/newrelic) は、さまざまなエージェント言語でウェブアプリケーションをホスティングするためのPaaS（Platform as a Service）ソリューションです。New Relic を使用すると、APM やブラウザ監視など、当社の監視ソリューションのメトリクスを使って Heroku を拡張することができます。New Relicのアドオンは、Java、Node.js、PHP、Python、Rubyをサポートしています。

## New Relicアドオンのインストール [#addon-installation]

New Relic アドオンを設定するには、 [Heroku のドキュメント](https://devcenter.heroku.com/articles/newrelic) （利用可能なプランレベルや Toolbelt の手順など）を参照してください。問題が発生した場合は、 [Heroku のサポートチャンネル](https://devcenter.heroku.com/articles/support-channels) をご利用ください。

## エージェントの設定 [#agent-installation]

[New Relic add-on for Heroku](https://devcenter.heroku.com/articles/newrelic) をインストールした後は、APM エージェントの設定手順に従ってください。

<CollapserGroup>
  <Collapser
    id="heroku-java"
    title="Java"
  >
    Java のエージェントの最小バージョンは 3.17.1 以上です。アドオン用にNew RelicのJavaエージェントをインストールして設定するには、 [JavaエージェントとHeroku](/docs/agents/java-agent/installation/java-agent-heroku) のドキュメントを参照してください。
  </Collapser>

  <Collapser
    id="heroku-nodejs"
    title="Node.js"
  >
    アドオン用の当社のNode.jsエージェントをインストールして設定するには、以下を参照してください。

    * New Relic の [Node.js と Heroku の](/docs/agents/nodejs-agent/hosting-services/nodejs-agent-heroku) ドキュメント
    * [ブログ記事](//beachape.com/blog/2013/02/04/nodejs-on-heroku-with-newrelic/) (2013) with a"real world" Herokuアプリに当社のNode.jsエージェントをインストールする例です。
  </Collapser>

  <Collapser
    id="heroku-php"
    title="PHP"
  >
    当社のPHPエージェントをアドオン用にインストールおよび設定するには、当社の [PHPエージェントおよびHeroku](/docs/agents/php-agent/advanced-installation/php-agent-heroku) ドキュメントを参照してください。
  </Collapser>

  <Collapser
    id="heroku-python"
    title="Python"
  >
    当社のPythonエージェントをアドオン用にインストールして設定するには、当社の [PythonエージェントとHeroku](/docs/agents/python-agent/hosting-services/python-agent-heroku) のドキュメントを参照してください。
  </Collapser>

  <Collapser
    id="heroku-ruby"
    title="Ruby"
  >
    アドオン用の当社のRubyエージェントをインストールおよび設定するには、当社の [RubyエージェントおよびHeroku](/docs/agents/ruby-agent/installation-configuration/ruby-agent-heroku) ドキュメントを参照してください。

    当社のRubyエージェントをRails以外のアプリケーションで使用している場合、Herokuユーザーは手動でリポジトリにプラグインをインストールする必要があります。例えば、Sinatraアプリでは、 `newrelic` gemを **Gemfile** に追加して、以下のコードをアプリに追加します。

    ```
    configure :production do
     require 'newrelic_rpm'
     end
    ```
  </Collapser>
</CollapserGroup>

## Herokuアドオンのアカウント管理 [#add-on-account]

Heroku 用の New Relic アドオンをインストールするたびに、New Relic は自動的に新しいアカウントを作成し、固有の [ライセンスキー](#heroku-add-on-license-key) 、 [アカウント URL](#heroku-add-on-account-url) 、 [アカウント ID](#heroku-add-on-account) を入力します。この 3 種類の情報は、Heroku 用アドオンの各アカウントを管理するために重要です。

<CollapserGroup>
  <Collapser
    id="heroku-add-on-license-key"
    title="ライセンスキー"
  >
    [ライセンスキー](/docs/apis/intro-apis/new-relic-api-keys/#ingest-license-key) は、お使いのアプリケーションがレポートするアカウントを特定します。アプリケーションが使用しているライセンスキーを確認するには、以下の手順に従います。

    1. コマンドラインから、次のように実行します。

       ```
       heroku config | grep -i relic
       ```

    2. `NEW_RELIC_LICENSE_KEY` の値を探してください。

       このライセンスキーの環境変数は、New Relic の設定ファイルにハードコーディングした他のライセンスキーよりも優先されます。
  </Collapser>

  <Collapser
    id="heroku-add-on-account-url"
    title="アカウントURL"
  >
    New Relicアドオンを複数回インストールし、HerokuアプリがNew Relicへのレポートに使用するURLを確認する必要がある場合は、エージェントログで、 `reporting to` を示す行と、その後にこの形式のURLを確認してください。

    ```
    rpm.newrelic.com/accounts/<var>###</var>/applications/<var>######</var>
    ```
  </Collapser>

  <Collapser
    id="heroku-add-on-account"
    title="アカウントID"
  >
    アドオンの [アカウント ID](/docs/accounts-partnerships/accounts/account-setup/account-id) を直接変更することはできません。HerokuアプリがNew Relicへのレポーティングに使用するNew Relicアカウントを変更する必要がある場合は、使用したいNew Relicアカウントのライセンスキーを指すように、その設定ファイルのcurrent license key環境変数を変更してください。

    ```
    heroku config:set NEW_RELIC_LICENSE_KEY=changed_account_license_key
    ```
  </Collapser>
</CollapserGroup>

## New Relicへのログオン [#signon]

Herokuをご利用のお客様は、New Relicに2種類のアカウントをお持ちの場合があります。

* アドオンアカウント。 [Heroku の New Relic アドオンを使用してお客様が Heroku アプリケーションにインストールした New Relic アカウント](https://addons.heroku.com/newrelic)
* "通常の" のアカウント。お客様がHerokuのアドオンでインストールしなかったその他のNew Relicアカウント

レギュラーアカウントは、アドオンアカウントに比べて幅広い機能を提供しており、インストール方法や管理方法も異なります。どちらのアカウントにサインインするかによって、手続きが異なります。

New RelicとHerokuのパートナーシップの条件に基づき、Herokuアドオン経由でNew Relicをインストールしたお客様は、HerokuからサインインすることでのみNew Relicのアドオンアカウントにアクセスすることができます。このため、アドオンアカウントと通常のNew Relicアカウントの両方をお持ちの場合、それらを直接切り替えることはできません。

<CollapserGroup>
  <Collapser
    id="heroku-add-on-login"
    title="HerokuからNew Relicアドオンのアカウントにサインインします。"
  >
    New Relic アドオンのアカウントにサインインするには。

    1. [id.heroku.com/login](https://id.heroku.com/login) のHerokuのログインページからサインインしてください。

    2. New Relic のアドオンがインストールされているアプリケーションを選択します。

    3. アドオンのリストから「New Relic」を選択します。

       Herokuからサインインした場合、 **[アカウントのドロップダウン](/docs/accounts-partnerships/education/getting-started-new-relic/glossary#account-dropdown) > アカウントの切り替え** を選択しても、通常のNew Relicアカウントは表示されません。
  </Collapser>

  <Collapser
    id="regular-login"
    title="通常のNew Relicアカウントへのサインイン"
  >
    通常のNew Relicアカウントにサインインしたり、切り替えたりするためのものです。

    1. **[one.newrelic.com](https://one.newrelic.com)** でNew Relicにサインインしてください。

    2. 通常のNew Relicアカウントから別のアカウントに切り替える場合。に行きます。\*\*[account dropdown](/docs/accounts-partnerships/education/getting-started-new-relic/glossary#account-dropdown) 、アカウントを選択します。

       New Relicから直接サインインした場合、 **[アカウントのドロップダウン](/docs/accounts-partnerships/education/getting-started-new-relic/glossary#account-dropdown) > アカウントの切り替え** を選択すると、HerokuからNew Relicのアドオンアカウントが表示されません。
  </Collapser>
</CollapserGroup>

## デプロイメント通知の設定 [#deployment]

Heroku アドオンは、アカウントごとに **1 つのアプリケーション** のデプロイメント通知を自動的に New Relic に送信します。アドオンのアカウントに複数のアプリケーションを追加した場合は、New Relic REST API を使用して、追加したアプリケーションのデプロイメント通知を手動で送信する必要があります。

New Relic REST API 呼び出しにはヘッダーが必要であり、Heroku のポストデプロイフックではヘッダーを許可していないため、ポストデプロイフックを使用することはできません。ただし、Heroku にデプロイするたびにこの API コールを生成するスクリプトを記述することは可能です。REST API を通じてデプロイを記録する手順については、 [デプロイの記録](/docs/apm/new-relic-apm/maintenance/recording-deployments#api) を参照してください。

<Callout variant="important">
  Heroku アドオンにユーザーを追加すると、New Relic にそのユーザーのユーザーレコードが作成されます。しかし、Heroku アドオンからユーザーを削除しても、New Relic からユーザーレコードは自動的に削除されません。代わりに、Herokuアドオンからユーザーを削除した後に、New Relicのユーザーレコードを手動で削除する必要があります。これを行うには、 **ユーザー管理** のページにアクセスします。
</Callout>