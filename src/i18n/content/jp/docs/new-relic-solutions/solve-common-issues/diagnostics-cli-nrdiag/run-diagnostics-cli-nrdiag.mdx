---
title: 診断用CLI（nrdiag）の実行
tags:
  - Using New Relic
  - Cross-product functions
  - Diagnostics CLI (nrdiag)
metaDescription: How to run the New Relic Diagnostics CLI (nrdiag) and upload results to a support ticket.
translationType: machine
---

<ButtonLink
  role="button"
  to="https://download.newrelic.com/nrdiag/nrdiag_latest.zip"
  variant="primary"
>
  最新版のダウンロード
</ButtonLink>

Diagnostics CLIを使用するには

1. [リリースノート](/docs/release-notes/diagnostics-release-notes/diagnostics-cli-release-notes/) を見て、最新バージョンであることを確認してください。
2. [Linux、macOS、Windows 用の実行ファイルを含む最新版](https://download.newrelic.com/nrdiag/nrdiag_latest.zip) をダウンロードできます。
3. お使いのプラットフォーム用の実行ファイルを、アプリケーションのルートディレクトリ [の場所に移動します。](/docs/agents/manage-apm-agents/troubleshooting/find-agent-root-directory)
4. [](/docs/agents/manage-apm-agents/troubleshooting/find-agent-root-directory)
5. [より正確なトラブルシューティングのために、New Relic エージェントの ](/docs/agents/manage-apm-agents/troubleshooting/find-agent-root-directory)[ロギングレベル](/docs/agents/manage-apm-agents/troubleshooting/new-relic-agent-logs-troubleshooting) を一時的に引き上げます。ロギングレベルを変更した後、アプリケーションを再起動してください。
6. **推奨：** トラブルシューティングの範囲をより簡単にするために、 `nrdiag` を [task suite](#suites) （CLIオプション）で実行します。

Diagnostics CLIは、ルート・ディレクトリとサブ・ディレクトリを自動的に検索して、エージェント構成ファイルやその他の関連データを探します。

## プラットフォーム固有の手順 [#platform]

Diagnostics CLIを実行するには、お使いのプラットフォームの手順に従ってください。

<CollapserGroup>
  <Collapser
    id="linux-run"
    title="Linux"
  >
    1. Diagnostics CLIがあることを確認します。

       * コマンドラインから、ディレクトリをアプリケーションのルートディレクトリに変更し、 `nrdiag.zip` ファイルが存在することを確認してください。

         または

       * [最新版を手動でダウンロードする](https://download.newrelic.com/nrdiag/nrdiag_latest.zip).

    2. 必要に応じて `nrdiag.zip` を解凍してください。

    3. `nrdiag_1.2.3/linux` ディレクトリから、 `nrdiag` をアプリケーションのルートディレクトリに移動します。

    4. `nrdiag` を実行します（ [の CLI オプションも一緒に）。](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/pass-command-line-options-nrdiag)

       ```
       ./nrdiag <var>CLI_OPTIONS</var>
       ```

       Diagnostics CLIは、発見した問題を出力し、添付フラグを含めると関連ファイルをNew Relicアカウントにアップロードします。
  </Collapser>

  <Collapser
    id="macos-run"
    title="macOS"
  >
    1. Diagnostics CLIがあることを確認します。

       * コマンドラインから、アプリケーションのルートディレクトリにディレクトリを変更し、 `nrdiag.zip` ファイルが存在することを確認してください。

         または

       * [最新版を手動でダウンロードする](https://download.newrelic.com/nrdiag/nrdiag_latest.zip).

    2. 必要に応じて `nrdiag.zip` を解凍してください。

    3. `nrdiag_1.2.3/mac` ディレクトリから、 `nrdiag` をアプリケーションのルートディレクトリに移動します。

    4. `nrdiag` を実行します（ [の CLI オプションも一緒に）。](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/pass-command-line-options-nrdiag)

       ```
       ./nrdiag <var>CLI_OPTIONS</var>
       ```

       Diagnostics CLIは、発見した問題を出力し、添付フラグを含めると関連ファイルをNew Relicアカウントにアップロードします。
  </Collapser>

  <Collapser
    id="windows-run"
    title="Windows"
  >
    1. Diagnostics CLIがあることを確認します。

       * コマンドラインから、アプリケーションのルートディレクトリにディレクトリを変更し、 `nrdiag.zip` ファイルが存在することを確認します。

         または

       * [最新版を手動でダウンロードする](https://download.newrelic.com/nrdiag/nrdiag_latest.zip).

    2. 必要に応じて `nrdiag.zip` を解凍してください。

    3. `nrdiag_1.2.3/win` ディレクトリから、 `nrdiag.exe` または `nrdiag_x64.exe` をアプリケーションのルートディレクトリに移動します。

    4. Webアプリケーションのトラブルシューティングでは、プロジェクトの **親** ディレクトリから実行ファイルを実行するか、 `-c` オプションで設定ファイルの場所を指定してください。

    5. バイナリを配置したディレクトリから、実行ファイル（任意の [CLIオプションと一緒に）](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/pass-command-line-options-nrdiag) を実行します。一部のチェックには昇格したパーミッションが必要なため、最良の結果を得るためには管理者シェルから実行してください。

       追加した場合はPowerShellで実行 `CLI_OPTIONS`:

       ```
       ./nrdiag.exe <var>CLI_OPTIONS</var>
       ```

       **OR** 、x64システムの場合。

       ```
       ./nrdiag_x64.exe <var>CLI_OPTIONS</var>
       ```

       Diagnostics CLI は、発見した問題を出力し、添付ファイルフラグを含めると関連ファイルを New Relic アカウントにアップロードします。
  </Collapser>

  <Collapser
    id="browser-run"
    title="ブラウザのモニタリング"
  >
    1. Diagnostics CLI の最新バージョンがあることを確認します。必要に応じて、 [手動で最新バージョンをダウンロードしてください](https://download.newrelic.com/nrdiag/nrdiag_latest.zip) 。

    2. 必要に応じて `nrdiag.zip` を解凍してください。

    3. `nrdiag_1.2.3/`<var> OS</var> ディレクトリから、 `nrdiag` を実行します（任意の [CLI オプションも一緒に実行します）](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/pass-command-line-options-nrdiag):

       ```
       ./nrdiag -browser-url <var>WEBSITE_URL</var> <var>CLI_OPTIONS</var>
       ```

       Diagnostics CLIは、発見した問題を出力し、添付ファイルフラグを含めると関連ファイルをNew Relicアカウントにアップロードします。
  </Collapser>

  <Collapser
    id="docker"
    title="Dockerコンテナ"
  >
    Dockerコンテナで実行されているNew Relic-instrumentedアプリケーションのトラブルシューティングには、 `docker exec` コマンドを使用します。

    1. [](https://download.newrelic.com/nrdiag/nrdiag_latest.zip)をダウンロードして、 `nrdiag_latest.zip` を解凍してください。

    2. バイナリをコンテナにコピーします。 `IMAGE_NAME` をお使いのdockerコンテナの名前に置き換えてください。

       ```
       docker cp nrdiag/linux/nrdiag <var>IMAGE_NAME</var>:/bin
       ```

    3. `nrdiag` コマンドを docker コンテナで実行します。 `IMAGE_NAME` を上記のように置き換え、 `APPLICATION_ROOT` を、New Relic エージェントをインストールしたアプリケーションのルートディレクトリに置き換えます。

       ```
       docker exec -it -w <var>APPLICATION_ROOT</var> <var>IMAGE_NAME</var> nrdiag
       ```

    4. (Optional) 終了したら `nrdiag` binary を削除します。

       ```
       docker exec <var>IMAGE_NAME</var> rm /bin/nrdiag
       ```
  </Collapser>
</CollapserGroup>

## スイーツフラグ（CLIオプションとして強く推奨） [#suites]

スイートとは、特定の製品や問題を対象としたヘルスチェックの集合体のことです。スイートを使用することで、トラブルシューティングの範囲を狭めたり、誤検知の発生を減らすことができます。

利用可能なスイートのリストを確認するには、 `-help suites` オプションを付けてDiagnostics CLIを実行します。

```
./nrdiag --help suites
```

`nrdiag` でスイートを実行するには、 `-suites` フラグと、実行する1つまたは複数のスイート名（例えば、 `java` ）を引数として指定します。

**Linux、macOS。**

* 32ビットシステムの場合

  ```
  ./nrdiag --suites <var>SUITE NAMES</var>
  ```

* 64ビットシステムの場合

  ```
  ./nrdiag_x64 --suites <var>SUITE NAMES</var>
  ```

**Windows：**

PowerShellから実行するには、 `./` を `cmd` の先頭に追加します。

* 32ビットシステムの場合

  ```
  nrdiag.exe --suites <var>SUITE NAMES</var>
  ```

* 64ビットシステムの場合

  ```
  nrdiag_x64.exe --suites <var>SUITE NAMES</var>
  ```

## 結果をNew Relicアカウントにアップロード [#attach-account-results]

<Callout variant="important">
  お使いのシステムが **外部の IP アドレスに** 接続しないように設定されている場合、この方法は機能しません。代わりに、 [出力ファイル](/docs/using-new-relic/cross-product-functions/diagnostics-cli-nrdiag/interpret-nrdiag-output) を New Relic サポートにメールで添付してください。ライセンスキーに問題がある場合は、結果を手動でアカウントにアップロードする必要があります。
</Callout>

### アカウントの自動アップロード [#automatic]

Diagnostics CLI の実行時に結果を自動的に New Relic アカウントにアップロードするには、 `-attach` または `-a` のコマンドラインフラグを使用します。これにより、お使いの環境で見つかったNew Relicのライセンスキーがアップロードのために検証されます。

結果をアカウントにアップロードすると、 `nrdiag-output.json` と `nrdiag-output.zip` の内容が自動的にアップロードされます。アップロード前にファイルの内容を確認したり変更したりしたい場合は、手動アップロードの手順に従ってください。

**Linux、macOS、合成プライベートミニオン。**

```
./nrdiag -attach
```

**Windows：**

PowerShellから実行するには、 `./` を `cmd` の先頭に追加します。

* 32ビットシステムの場合

  ```
  nrdiag.exe -attach
  ```

* 64ビットシステムの場合

  ```
  nrdiag_x64.exe -attach
  ```

### 手動アップロード [#manual]

サポートチケットをお持ちの方は、パーマリンク機能を使って結果を共有してください。これにより、トラブルシューティングのスピードが向上します。New Relic 診断アプリでは、結果を自動的にアップロードできない場合、ドラッグ＆ドロップの機能があります。
